---
import { TabItem, Tabs } from "@astrojs/starlight/components";
import { Code } from "@astrojs/starlight/components";

interface Props {
  /**
   * Any command that needs to be run before the one using the package manager.
   * This is not affected by the prefix.
   */
  preCommand?: string | string[];
  /**
   * The command to run with the package manager.
   * If an array is provided, each of them will be run in a new line.
   */
  command: string | string[];
  /**
   * A prefix to be added to each command.
   * This is helpful to define env variables.
   */
  prefix?: string;
}

const { preCommand, command } = Astro.props;
const prefix = Astro.props.prefix ? `${Astro.props.prefix.trimEnd()} ` : "";
const commands = Array.isArray(command) ? command : [command];
const preCommands =
  preCommand === undefined
    ? []
    : Array.isArray(preCommand)
      ? preCommand
      : [preCommand];

function getCode(packageManagerName: string): string {
  return [
    ...preCommands,
    ...commands.map((c) => `${prefix}${packageManagerName} ${c}`),
  ].join("\n");
}
---

<Tabs syncKey="package-manager">
  <TabItem label="npm" icon="npm">
    <Code code={getCode("npm")} lang="sh" frame="terminal" />
  </TabItem>

  <TabItem label="pnpm" icon="pnpm">
    <Code code={getCode("pnpm")} lang="sh" frame="terminal" />
  </TabItem>
  <TabItem label="Yarn" icon="seti:yarn">
    <Code code={getCode("yarn")} lang="sh" frame="terminal" />
  </TabItem>
</Tabs>
